<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Spooky Lyrics Overlay</title>
<link href="https://fonts.googleapis.com/css2?family=Creepster&family=Carrois+Gothic+SC&display=swap" rel="stylesheet"/>
<style>
:root {
  --neon-red: #f22;
  --neon-green: #0f0;
  --neon-glow: 0 0 6px var(--neon-green);
}
body {
  margin:0; padding:2rem;
  background:transparent; color:#ccc;
  font-family:'Carrois Gothic SC',sans-serif;
  display:flex; justify-content:center; align-items:flex-start;
}
.container {
  display:flex; gap:2rem;
}
.lyrics-box {
  width:400px; height:300px;
  overflow-y:auto;
  text-align:center;
  padding:1rem;
  font-size:1rem;
  color:var(--neon-red);
  text-shadow:0 0 4px var(--neon-red);
  box-sizing:border-box;
}
.lyrics-box::-webkit-scrollbar{width:0}
.metadata {
  display:flex; flex-direction:column; align-items:center;
}
.cover {
  width:300px; height:300px;
  object-fit:cover;
  border-radius:12px;
  background:#111;
  box-shadow:0 0 20px 10px red;
}
.title, .artist {
  font-family:'Creepster',cursive;
  -webkit-text-stroke:1px black;
  text-align:center;
}
.title { font-size:2.2rem; color:#f44; margin-top:0.5rem }
.artist { font-size:1.4rem; color:#0f0; margin-bottom:1rem }
.player {
  width:400px;
  background:#000;
  border:2px solid #000;
  border-radius:10px;
  padding:0.5rem;
  margin-top:1rem;
  display:flex; align-items:center;
  position:relative;
  box-shadow:0 0 8px #000;
}
.btn {
  background:transparent; border:none;
  cursor:pointer; padding:0; margin-right:0.5rem;
}
.btn svg {
  fill: white;
  filter: var(--neon-glow);
  transition:transform .2s;
}
.btn.green svg {
  filter: drop-shadow(0 0 6px var(--neon-green));
}
.btn.green:hover svg {
  transform:scale(1.2);
}
.time {
  color:#fff; font-size:0.9rem;
  width:45px; text-align:center;
}
.progress {
  flex:1; height:6px;
  background:#444; margin:0 0.5rem;
  cursor:pointer; position:relative;
  border-radius:4px;
}
.progress-filled {
  height:100%; width:0;
  background:var(--neon-red);
  border-radius:4px;
  transition:width .1s linear;
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0%,100%{box-shadow:0 0 4px var(--neon-red)}
  50%{box-shadow:0 0 10px var(--neon-red)}
}
.tooltip {
  position:absolute; top:-25px;
  background:#222; color:#fff;
  padding:2px 6px;
  font-size:0.8rem; border-radius:4px;
  display:none;
}
.playlist-panel {
  position:absolute; bottom:100%;
  width:100%;
  max-height:200px;
  background:#000;
  border:2px solid var(--neon-green);
  overflow-y:auto;
  display:none;
  flex-direction:column;
  animation:fadeIn 0.3s ease forwards;
  text-transform:none;
}
.playlist-panel.fade-out {
  animation:fadeOut .3s ease forwards;
}
.playlist-panel::-webkit-scrollbar {
  width:6px; background:#111
}
.playlist-panel::-webkit-scrollbar-thumb {
  background:var(--neon-red)
}
.track {
  padding:.4rem 1rem;
  cursor:pointer;
  color:var(--neon-red); font-weight:bold;
}
.track:hover { background:#222 }
.playlist-title {
  background:var(--neon-green);
  color:#000;
  text-align:center;
  padding:.3rem;
  font-weight:bold;
}
@keyframes fadeIn {
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}
@keyframes fadeOut {
  from{opacity:1;transform:none}
  to{opacity:0;transform:translateY(10px)}
}
</style>
</head>
<body>
<div class="container">
  <div class="lyrics-box" id="lyricsBox">Loading lyrics…</div>

  <div class="metadata">
    <img id="coverArt" class="cover" src="" alt="Cover"/>
    <div class="title" id="songTitle">Loading title…</div>
    <div class="artist" id="artistName">Loading artist…</div>

    <div class="player">
      <button class="btn green playlist-button" id="playlistToggle">
        <svg width="20" height="20"><rect y="3" width="20" height="3"/><rect y="9" width="20" height="3"/><rect y="15" width="20" height="3"/></svg>
      </button>
      <button class="btn green play-button" id="playButton">
        <svg width="20" height="20" viewBox="0 0 100 100"><polygon points="40,30 70,50 40,70"/></svg>
      </button>
      <span class="time" id="currentTime">0:00</span>
      <div class="progress" id="progressBar">
        <div class="tooltip" id="tooltip">0:00</div>
        <div class="progress-filled" id="progressFill"></div>
      </div>
      <span class="time" id="totalTime">0:00</span>

      <div class="playlist-panel" id="playlistPanel">
        <div class="playlist-title">PLAYLIST</div>
        <div id="playlistTracks"></div>
      </div>
    </div>
    <audio id="audioPlayer"></audio>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const audio=document.getElementById('audioPlayer'),
 playBtn=document.getElementById('playButton'),
 playSvg=playBtn.querySelector('svg'),
 playlistBtn=document.getElementById('playlistToggle'),
 playlistPanel=document.getElementById('playlistPanel'),
 tracksContainer=document.getElementById('playlistTracks'),
 progressBar=document.getElementById('progressBar'),
 progressFill=document.getElementById('progressFill'),
 curTime=document.getElementById('currentTime'),
 totalTime=document.getElementById('totalTime'),
 tooltip=document.getElementById('tooltip'),
 lyricsBox=document.getElementById('lyricsBox'),
 titleEl=document.getElementById('songTitle'),
 artistEl=document.getElementById('artistName'),
 coverEl=document.getElementById('coverArt');

function fmt(t){if(isNaN(t))return"0:00";const m=Math.floor(t/60),s=Math.floor(t%60).toString().padStart(2,'0');return`${m}:${s}`}
function conv(u){return u?.includes("dropbox")?u.replace("www.dropbox.com","dl.dropboxusercontent.com").replace("&dl=0",""):u}

let data=[];
Papa.parse('/.netlify/functions/fetchSheet',{download:true,header:true,complete:r=>{
 data=r.data.filter(r=>r['Song title']&&r['Lyrics']);
 data.forEach((d,i)=>{
   const div=document.createElement('div');
   div.className='track';
   div.textContent=`${d['Song title']} — ${d['Artist name']}`;
   div.onclick=()=>loadTrack(i);
   tracksContainer.appendChild(div);
 });
 loadTrack(data.length-1);
}});

function loadTrack(i){
 const d=data[i];
 titleEl.textContent=d['Song title'];
 artistEl.textContent=d['Artist name'];
 coverEl.src=conv(d['Cover art']);
 audio.src=conv(d['Direct download link']);
 lyricsBox.innerHTML=d['Lyrics'].split('\n').map(l=>`<div>${l}</div>`).join('');
}

audio.ontimeupdate=()=>{
 curTime.textContent=fmt(audio.currentTime);
 progressFill.style.width=(audio.currentTime/audio.duration)*100+'%';
};
audio.onloadedmetadata=()=>totalTime.textContent=fmt(audio.duration);
audio.onplay=()=>playSvg.innerHTML='<polygon fill="white" points="37,30 47,30 47,70 37,70 60,70 60,30"/>'; 
audio.onpause=()=>playSvg.innerHTML='<polygon fill="white" points="40,30 70,50 40,70"/>';

playBtn.onclick=()=>audio.paused?audio.play():audio.pause();

progressBar.onclick=e=>{
 const r=progressBar.getBoundingClientRect(),pct=(e.clientX-r.left)/r.width;
 audio.currentTime=pct*audio.duration;
};
progressBar.onmousemove=e=>{
 const r=progressBar.getBoundingClientRect(),pct=(e.clientX-r.left)/r.width;
 tooltip.style.left=(e.clientX-r.left)+'px';
 tooltip.textContent=fmt(pct*audio.duration);
 tooltip.style.display='block';
};
progressBar.onmouseleave=()=>tooltip.style.display='none';

let plOpen=false;
playlistBtn.onclick=()=>{
 plOpen=!plOpen;
 if(plOpen)playlistPanel.style.display='flex',playlistPanel.classList.remove('fade-out');
 else playlistPanel.classList.add('fade-out'),setTimeout(()=>{playlistPanel.style.display='none'},300);
};
</script>
</body>
</html>
